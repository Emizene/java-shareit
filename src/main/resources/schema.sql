DROP TABLE IF EXISTS users CASCADE;
DROP TABLE IF EXISTS items CASCADE;
DROP TABLE IF EXISTS booking CASCADE;
DROP TABLE IF EXISTS comments CASCADE;

CREATE TABLE IF NOT EXISTS users
   (id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
   name VARCHAR(100) NOT NULL,
   email VARCHAR(100) NOT NULL,
   CONSTRAINT valid_email CHECK (email LIKE '%@%.%'));

CREATE TABLE IF NOT EXISTS items
   (id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
   name VARCHAR(255),
   description VARCHAR(255),
   available BOOLEAN,
   owner_id BIGINT,
   FOREIGN KEY (owner_id) REFERENCES users(id) ON DELETE CASCADE);

CREATE TABLE IF NOT EXISTS bookings
   (id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
   start_date TIMESTAMP WITHOUT TIME ZONE,
   end_date TIMESTAMP WITHOUT TIME ZONE,
   item_id BIGINT,
   booker_id BIGINT,
   status VARCHAR(20),
   FOREIGN KEY (item_id) REFERENCES items(id) ON DELETE CASCADE,
   FOREIGN KEY (booker_id) REFERENCES users(id) ON DELETE CASCADE);

CREATE TABLE IF NOT EXISTS comments
   (id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
   text VARCHAR(255),
   item_id BIGINT,
   created TIMESTAMP WITHOUT TIME ZONE NOT NULL,
   author_id BIGINT NOT NULL,
   FOREIGN KEY (item_id) REFERENCES items(id) ON DELETE CASCADE,
   FOREIGN KEY (author_id) REFERENCES users(id) ON DELETE CASCADE);

-- CREATE TABLE IF NOT EXISTS requests
--    (id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
--    description VARCHAR(512) NOT NULL,
--    requestor_id BIGINT NOT NULL,
--    FOREIGN KEY (requestor_id) REFERENCES users(id) ON DELETE CASCADE);